<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Neucha&display=swap" rel="stylesheet"> 
    <style>
        *{
            font-family: 'Neucha', cursive;
            font-size:20px;
            font-weight: 800;
        }
        body{
            height: 100%;
            background-image: url('Images/gradient.png');
            background-size: cover;
        }
        .screen {
            display:grid;            
            grid-template-columns: 1fr, 4fr;
            width: 100%;
            
        }
        .sample {
            grid-column: 1;
            grid-row: 1;
            height: 350px;
            border: solid  rgb(10, 212, 248);
            margin-bottom: 5px;
            margin-right: 5px;
            align-items: center;
            vertical-align: middle;
            display: flex;
            justify-content: center;
        }
        
        .menu {
            grid-column: 1;
            grid-row: 2;
            border: solid rgb(10, 212, 248);
            margin-right: 5px;
            height: 500px;
           
            text-align: center;
        }
        .menu div{
            align-items: center;
            margin: 10px;
        }
        .main {
            
            grid-column: 2;
            grid-row: 1;
            border: solid rgb(10, 212, 248);
            margin-bottom: 5px;
            align-items: center;
            vertical-align: middle;
            display: flex;
            justify-content: center;
        }
        #place {
            display: inline-block;
            border:#d8bfd8 solid;
            text-align: center;
            position: relative;
            border-radius: 5px;
            transform: translateZ(0);
          
        }
        #sam{
            display: inline-block;
            height: 300px;
            width: 300px;
            border: 2px  dashed thistle solid;
            position: relative;
            transform: translateZ(0);
            transition-duration: 3s;
            border-radius: 3px;
        }
        .plate {
            grid-column: 2;
            grid-row: 2;
            border: solid  #0ad4f8;
            display: grid;
                        
        }
        .plate div{
            width: 150px;
            height: 150px;
        }
        .plitki{
            width: 130px;
            height: 130px;
            border:#d8bfd8 solid;
            margin: 2px;
            background-size: 100%;
            transition-duration: 1s;
            border-radius: 5px;
        }
        #d1, #d2, #d3, #d4, #d5,#d6{
            grid-row: 1;
        }
        input{
            width: 200px;
            height: 50px;
            
            border-radius: 3px;
            background-color: rgb(209, 224, 243);
            border-color:  #0ad4f8;
            box-shadow: mediumturquoise 0 0 5px inset;
            color: #3b1196;
        }
                        
    </style>
</head>
<body>
<div id='myPage'>    
    
<div class='screen' id='scr'>   
    
    <div class="sample">
        <div id='sam'></div>
    </div>
    <div class="menu">
        <div><input type="button" value="Подсказка" onclick="imgHelp()"> </div>
        <div><input type="button" value="Предыдущее задание" onclick="imgPre()"> </div>
        <div><input type="button" value="Следующее задание" onclick="imgNext()"></div>
        <div><input type="button" value="Каталог заданий" onclick="imgCatalog()"></div>
        <div><input type="button" value="На главную" onclick="mainPage()"></div>
    </div>
    <div class="main">
        
        <div id='place'></div>
        <div class='button'>
            <input type="button" value="Повернуть пластинку" onclick="imgRotate()"> 
            <input type="button" value="Убрать пластинку" onclick="imgDelete()">
            <input type="button" value="Проверить" onclick="imgVerify()">
        </div>
    </div>
    <div class="plate">
        <div id='d1'><img id='r1' class='plitki' src="Images/rt1.png"></div>
        <div id='d2'><img id='r2' class='plitki' src="Images/rt2.png"></div>
        <div id='d3'><img id='r3' class='plitki' src="Images/rt3.png"></div>
        <div id='d4'><img id='r4' class='plitki' src="Images/rt4.png"></div>
        <div id='d5'><img id='r5' class='plitki' src="Images/rt5.png"></div>
        <div id='d6'><img id='r6' class='plitki' src="Images/rt6.png"></div>
        <div id='d7'><img id='r7' class='plitki' src="Images/rt7.png"></div>
        <div id='d8'><img id='r8' class='plitki' src="Images/rt8.png"></div>
        <div id='d9'><img id='r9' class='plitki' src="Images/rt9.png"></div>
        <div id='d10'><img id='r10' class='plitki' src="Images/rt10.png"></div>
        <div id='d11'><img id='r11' class='plitki' src="Images/rt11.png"></div>
        <div id='d12'><img id='r12' class='plitki' src="Images/rt12.png"></div>
        <div id='d13'><img id='r13' class='plitki' src="Images/rt13.png"></div>
        <div id='d14'><img id='r14' class='plitki' src="Images/rt14.png"></div>
        <div id='d15'><img id='r15' class='plitki' src="Images/rt15.png"></div>
        <div id='d16'><img id='r16' class='plitki' src="Images/rt16.png"></div>
        <div id='d17'><img id='r17' class='plitki' src="Images/rt17.png"></div>
        <div id='d18'><img id='r18' class='plitki' src="Images/rt18.png"></div>
    </div>         
</div> 
</div>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.3.3/dist/confetti.browser.min.js"></script>
<script>
    "use strict";
    var square=300;              //Устанавливаем размер "приемника" для плиток
    var parSquare=130;           // Устанавливаем исходный размер для плиток
    var helpSquare=square*0.5;  //уменьшение пластинок при разложении на подсказке
    var choice;            //Переменная, в которой будет лежать номер образца задания при загрузке, берется из LocalStorage или 0 (первое из массива заданий) 

    window.onhashchange=switchToStateFromURLHash;     // в закладке УРЛа будем хранить полное JSON-представление состояния приложения

    // текущее состояние приложения
    var SPAState={};    // могут быть элементы pagename и numberChoice (номер образца)
                        // вызывается при изменении закладки УРЛа  а также при первом открытии страницы
                        // читает новое состояние приложения из закладки УРЛа  и обновляет ВСЮ вариабельную часть веб-страницы
    var storage=localStorage.colorCode;
    if (!storage){
        choice=0;
    }
    else {
        choice=parseInt(storage); 
    };
    //console.log(choice);
    var example=[                       //создаем массив с образцами заданий разной сложности, всего 85 заданий
        [r2, 0, r6, 0],  // все значения парами: id плитки и угол поворота по часовой стрелке
        [r9, 0, r5, 0],
        [r2, 0, r12, 0],
        [r13, 270, r10, 180],
        [r12, 270, r6, 0],
        [r10, 0, r9, 270],
        [r12, 0, r15, 90],
        [r1, 90, r14, 270],
        [r13, 90, r7, 90],
        [r8, 180, r1, 0],
        [r5, 0, r8, 180],
        [r2, 0, r15, 270],
        [r9, 180, r13, 90],
        [r5, 0, r6, 0, r8, 0],
        [r9, 0, r6, 0, r10, 90],
        [r7, 180, r13, 0, r2, 0],
        [r4, 0, r1, 180, r16, 270],
        [r6, 0, r14, 270, r15, 0],
        [r5, 0, r3, 0],
        [r2, 0, r6, 0, r12, 270],
        [r7, 180, r13, 270, r11, 180],
        [r8, 0, r9, 180, r16, 270],
        [r9, 90, r10, 180, r17, 270],
        [r6, 0, r16, 0, r1, 90],
        [r7, 180, r4, 270, r10, 180],
        [r5, 180, r13, 90, r17, 0],
        [r2, 0, r11, 90, r10, 0],
        [r13, 270, r12, 0, r15, 0],
        [r14, 90, r5, 180, r17, 270],
        [r18, 180, r12, 0, r4, 0],
        [r5, 180, r1, 180, r17, 0],
        [r2, 0, r15, 180, r11, 0],
        [r18, 180, r11, 270, r4, 270],
        [r10, 180, r4, 270, r3, 180],
        [r8, 180, r12, 90, r17, 0],
        [r9, 180, r11, 270, r14, 0],
        [r13, 180, r5, 180, r15, 270],
        [r18, 180, r9, 90, r4, 0],
        [r12, 90, r16, 90, r14, 270, r17, 0],
        [r18, 0, r13, 90, r14, 270, r7, 270],
        [r12, 90, r1, 180, r17, 0, r9, 180],
        [r5, 0, r1, 270, r14, 90, r17, 180],
        [r5, 180, r8, 0, r11, 0, r2, 0],
        [r5, 270, r14, 0, r17, 90, r7, 0],
        [r2, 0, r4, 270, r13, 0, r16, 90],
        [r9, 90, r10, 270, r14, 270, r7, 270],
        [r16, 90, r4, 180, r15, 90, r1, 270],
        [r2, 0, r12, 180, r16, 270, r3, 90],
        [r13, 0, r12, 180, r7, 180, r15, 180],
        [r14, 180, r11, 90, r5, 180, r13, 270],
        [r6, 0, r9, 90, r11, 90, r1, 90],
        [r5, 90, r11, 90, r17, 90, r14, 90],
        [r6, 0, r12, 90, r3, 90, r1, 90],
        [r18, 90, r7, 180, r4, 270, r10, 180],
        [r5, 180, r12, 90, r8, 90, r17, 90],
        [r18, 90, r12, 180, r11, 0],
        [r8, 90, r15, 270, r3, 270],
        [r9, 180, r18, 0, r14, 0, r4, 0],
        [r13, 180, r2, 0, r15, 270, r16, 270],
        [r6, 0, r11, 90, r17, 270, r3, 180],
        [r2, 0, r7, 270, r6, 0, r1, 90, r14, 180],
        [r13, 270, r12, 90, r15, 270, r3, 270, r4, 90],
        [r9, 90, r7, 0, r11, 180, r14, 180, r10, 0],
        [r2, 0, r11, 90, r7, 90, r15, 0, r16, 90],
        [r12, 0, r7, 0, r1, 90, r14, 180, r11, 270],
        [r18, 0, r2, 0, r15, 180, r4, 180, r16, 90],
        [r13, 90, r12, 0, r14, 0, r15, 0, r2, 0],
        [r14, 270, r6, 0, r9, 90, r7, 270, r13, 0],
        [r13, 270, r11, 0, r1, 180, r15, 180],
        [r12, 270, r9, 90, r7, 90, r11, 90, r15, 0],
        [r6, 0, r1, 180, r14, 0, r9, 180, r17, 270],
        [r12, 270, r10, 0, r7, 270, r8, 180, r3, 180],
        [r10, 0, r14, 90, r7, 0, r15, 0, r3, 90],
        [r12, 0, r11, 90, r5, 0, r3, 0, r17, 180],
        [r1, 180, r13, 0, r6, 0, r15, 0, r3, 0],
        [r12, 270, r9, 90, r11, 180, r10, 0, r13, 0],
        [r18, 270, r15, 0, r11, 270, r14, 180, r3, 270],
        [r13, 0, r11, 0, r15, 270, r3, 180],
        [r1, 90, r5, 270, r6, 0, r12, 180, r11, 0],
        [r12, 90, r13, 270, r8, 90, r15, 90],
        [r2, 0, r11, 270, r14, 270, r16, 0, r4, 90],
        [r15, 0, r9, 180, r10, 90, r13, 90, r14, 180],
        [r18, 270, r1, 180, r17, 90, r4, 90, r3, 0],
    ];
    var last=example.length;
    
    function exampleChoice(choice){             // Описываем функцию заполнения поля с образцами
        var sam=document.getElementById('sam'); 
        sam.innerHTML='';                   //Очищаем от предыдущей картинки
                                                  
        var ex=example[choice];                   //Находим нужный образец по индексу в массиве Example
        
        for (var i=0; i<ex.length; i+=2 ){
            var s=document.createElement('img');
            s.src=(ex[i].src);
            s.style.position='absolute';
            s.style.width=square +'px';
            s.style.height=square +'px';
            s.style.zIndex=i;
            s.style.borderColor='#d8bfd8';
            s.style.borderWidth=2+'px';
            s.style.borderRadius=5+'px';
            s.style.borderStyle='solid';
            var u=ex[i+1];
            s.style.transform='rotate('+ u + 'deg)';
            sam.appendChild(s);
            localStorage.colorCode=choice;   //сохраняем номер задания в localStorage
        }
     
    }
    exampleChoice(choice);       
    var myPage=document.getElementById('myPage');
    var scrn=document.getElementById('scr');

    function mainPage(){                                           //функция вызывает главную страницу
        var main=document.createElement('div');
        main.id='mainPa';
        main.style.textAlign='center';        
        myPage.innerHTML='';

        myPage.appendChild(main);
        var header=document.createElement('div');                    //создаем заголовок
        header.style.display='inline-block';
        header.style.alignItems='center';
        header.style.marginTop=150+'px';

        mainPa.appendChild(header);
        var words=['Ц', 'В', 'E', 'Т', 'О', 'В', 'О', 'Й', 'п', 'К', 'О', 'Д']; 
        for (var l=0; l<words.length; l++){
            var letter=document.createElement('div');
            letter.innerText=words[l];
            letter.style.display='inline-block';
            letter.style.borderColor='#d8bfd8';
            letter.style.borderStyle='solid';
            letter.style.borderRadius=5+'px';
            letter.style.margin=2+'px';
            letter.style.paddingTop=8+'px';
            letter.style.paddingBottom=8+'px';
            letter.style.paddingLeft=20+'px';
            letter.style.paddingRight=20+'px';
            letter.style.fontSize=4+'em';
            letter.style.fontWeight='bold';
            header.appendChild(letter);
        }
        var letters=header.children;
        letters[0].style.color='#1489f7'; 
        letters[0].style.transform='rotate('+340+'deg)';
        letters[1].style.color='#85095b'; 
        letters[1].style.transform='rotate('+15+'deg)';
        letters[2].style.color='#90f252'; 
        letters[2].style.transform='rotate('+25+'deg)';
        letters[3].style.color='#fcdb35';
        letters[3].style.transform='rotate('+350+'deg)'; 
        letters[4].style.color='#188c3f'; 
        letters[4].style.transform='rotate('+335+'deg)';
        letters[5].style.color='#f22734'; 
        letters[5].style.transform='rotate('+355+'deg)';
        letters[6].style.color='#3b1196'; 
        letters[6].style.transform='rotate('+10+'deg)';
        letters[7].style.color='#e4f52f';
        letters[7].style.transform='rotate('+350+'deg)';
        letters[8].style.visibility='hidden';
        letters[9].style.color='#450696'; 
        letters[9].style.transform='rotate('+355+'deg)';
        letters[10].style.color='#450696'; 
        letters[10].style.transform='rotate('+10+'deg)';
        letters[11].style.color='#450696';
        letters[11].style.transform='rotate('+350+'deg)';

        header.style.left=main.offsetWidth/2-header.offsetWidth/2;

        var buttons=document.createElement('div');
        buttons.style.marginTop=100+'px';
        buttons.style.textAlign='center';
        mainPa.appendChild(buttons);

        var but1=document.createElement('input');
        but1.type='button';
        but1.value='Каталог заданий';
        but1.style.marginBottom=15+'px';
        but1.onclick=imgCatalog;
        buttons.appendChild(but1);
        var br1=document.createElement('br');
        buttons.appendChild(br1);

        var but2=document.createElement('input');
        but2.type='button';
        but2.value='Играть';
        but2.style.marginBottom=15+'px';
        but2.onclick=runGame;
        //but2.onclick=switchToState( { pagename:'Game', numberChoice:choice } );
        buttons.appendChild(but2);
        var br2=document.createElement('br');
        buttons.appendChild(br2);

        var but3=document.createElement('input');
        but3.type='button';
        but3.value='Правила игры';
        buttons.appendChild(but3);
        switchToState( { pagename:'Main' } )
    }
    var place = document.getElementById('place');
    place.style.width=square + 0 +'px';
    place.style.height=square + 0 +'px';        

    var record=[];               //Заводим массив, в котором будет собираться информация какие плитки и в каком положении выбрал пользователь
    
    window.addEventListener("load", setPosition, false);
    function setPosition(EO) {
        EO=EO||window.event;
        var elems=document.getElementsByClassName('plitki');          
        
        for (var i=elems.length-1; i>=0; i-- ){
            var elem=elems[i];
            elem.onclick = imgClick;            
        };
        
    };
    function imgClick(EO) {          //Перемещаем выбранную пластинку
        EO = EO || window.event;
        EO.preventDefault();
        var pict = EO.target;  
        pict.style.position='absolute'; 
  
        var count=0;                  //Заводим счетчик Z-index -ов
    
        var place = document.getElementById('place');   
        pict.style.zIndex=count++;
        pict.style.left=0+'px';
        pict.style.top=0+'px';
        pict.style.margin=0+'px';
        pict.style.width=square +'px';
        pict.style.height=square +'px';
        var audio = new Audio('Sound/Click.mp3');
        audio.play(); 
        place.appendChild(pict);
          

        function imgRecord(pict){    //Проверяем есть ли данные о выбранной пластинке в массиве record, т.к. пользователь может несколько раз
            for (var i=0;            //  нажимать на одну и ту же пластинку
                i<record.length;   
                i++ ){
                var b=record[i];
                var c=pict.id;
                if (b==c)
                return true
                else false
            }
            return
        }
        
        if (imgRecord(pict)==true){      //записываем в массив record данные о выбранных пластинках (id), если они туда не записаны ранее, а также угол поворота,
        }    
        else record.push(pict.id, 0);    // первоначальный угол 0градусов
        
        window.onmousemove = null; 
        //console.log(record);
        return record
    }
    function imgRotate(){        //функция поворачивает верхнюю пластинку, вызывается кнопкой
        var parent=document.getElementById('place');
        var rot=parent.lastChild;       //Находим самую верхнюю пластинку
        var ugol=record.pop();      //Текущий угол поворота пластинки- это последний элемент в массиве record;      
        ugol=ugol+90;       
        rot.style.transform='rotate('+ugol+'deg)';  //поворачиваем пластинку
        record.push(ugol);         //  записываем новую величину угла в массив
        ugol=0;
        var audio2 = new Audio('Sound/Rotate.mp3');
        audio2.play(); 
        
        
    }
    function imgDelete(){             // функция удаляет верхнюю пластинку на ее прежнее место, вызывается кнопкой
        var parent=document.getElementById('place');
        var rot=parent.lastChild;       //Находим самую верхнюю пластинку
        rot.style.position='static';
        rot.style.width=parSquare +'px';
        rot.style.height=parSquare +'px';
        rot.style.transform='rotate('+ 0 + 'deg)';
        
        record.pop();   //удаляем из массива record угол поворота пластинки
        record.pop();   //удаляем из массива record имя пластинки
        var name=rot.id;
        var mother;
                      //   Возвращаем пластинки на исходные места
        switch (name) {
            case 'r1':
                mother= document.getElementById('d1');
                break;
            case 'r2':
                mother= document.getElementById('d2');
                break;
            case 'r3':
                mother= document.getElementById('d3');
                break;
            case 'r4':
                mother= document.getElementById('d4');
                break;
            case 'r5':
                mother= document.getElementById('d5');
                break;
            case 'r6':
                mother= document.getElementById('d6');
                break;
            case 'r7':
                mother= document.getElementById('d7');
                break;    
            case 'r8':
                mother= document.getElementById('d8');
                break;
            case 'r9':
                mother= document.getElementById('d9');
                break;    
            case 'r10':
                mother= document.getElementById('d10');
                break;  
            case 'r11':
                mother= document.getElementById('d11');
                break;    
            case 'r12':
                mother= document.getElementById('d12');
                break;   
            case 'r13':
                mother= document.getElementById('d13');
                break;     
            case 'r14':
                mother= document.getElementById('d14');
                break;  
            case 'r15':
                mother= document.getElementById('d15');
                break;   
            case 'r16':
                mother= document.getElementById('d16');
                break;  
            case 'r17':
                mother= document.getElementById('d17');
                break;   
            case 'r18':
                mother= document.getElementById('d18');
                break;           
            }    
        
        mother.appendChild(rot);
        var audio1 = new Audio('Sound/Delete.mp3');
        audio1.play(); 
        mother=null;
        
    }
    var rezult;
    function imgVerify(){  //Проверяем решение задания: сравниваем массивы [record] и [example[choice]]
        var recordCompare=[];   //из массива record переносим и преобразуем данные в массив recordCompare (обрезаем значения углов)
        console.log(record);
        for (var i=0; i<record.length; i=i+2 ){
            recordCompare.push(record[i]);
            var ug=record[(i+1)];                        
                             
                var name=record[i];                 
                switch (name) {        //для фигур, которые не меняются от поворота (ромб, квадрат) угол равен 0
                    case 'r2':
                    ug=0;
                break;
                    case 'r6':
                    ug=0;
                break;
                }
                if (ug>=360) {       //значения углов поворота 
                    var m=parseInt(ug/360)  //целое число от деления угла на 360
                    ug=ug-(m*360);        //убираем полные обороты в 360 градусов                     
                    }
                else ug    
            recordCompare.push(ug);
                        
        }
        console.log(recordCompare);
        var exampleCompare=[];   //из массива example[choice] переносим и преобразуем данные в массив exampleCompare (только id, а не весь элемент в массив)
        var exLen=example[choice].length;
        var ex=example[choice];
        for (var u=0; u<exLen; u=u+2 ){
            exampleCompare.push(ex[u].id);
            exampleCompare.push(ex[u+1]); 
        }     
        console.log(exampleCompare);

        var recLen=recordCompare.length;
        console.log(recLen, exLen);
        if(recLen==exLen){
            rezult=true;
            arrayCompare(recordCompare, exampleCompare);
        }
        else rezult=false;
        console.log(rezult);

        function arrayCompare(){
            for (var n=0; n<exLen; n++ ){
            var redCom=recordCompare[n];
            var exi=exampleCompare[n];
            console.log(redCom, exi);
                if(redCom==exi){
                    rezult=true;
                    console.log(redCom, exi, rezult);
                    continue
                }
                else rezult=false;  break;  console.log(rezult);               
            }
            return rezult
        }
        console.log(rezult);
        showRezult(rezult);
        return rezult
    }
    
    
    function imgNext(){
        if (choice>=example.length-1){
        choice=0;
        }
        else{
        choice=choice+1;
        };
        exampleChoice(choice);
        var c=0;
        if (record.length>0){
            for (c=0; c<record.length;  c=c+2){
                imgDelete();                   
            }          
        }  
        
        switchToState( { pagename:'Game', numberChoice:choice } );    
    }
    function imgPre(){
        if (choice<=0){
        choice=example.length-1;
        }
        else{
        choice=choice-1;
        }
        exampleChoice(choice);
        var c=0;
        if (record.length>0){
        for (c=record.length; c>=0;  c=c-2){
            imgDelete();                   
        }  
        }   
        switchToState( { pagename:'Game', numberChoice:choice } );     
    }
    function imgHelp(){        
        var child=sam.children;
        console.log(child);
        for (var i=0; i<child.length; i++){
            var x=-120+(90*i);
            var y=110-(25*i);
            var ex=example[choice];
            var u=ex[i*2+1];
            child[i].style.transform='translateZ(0)translateX('+x+'px)translateY('+y+'px)rotate('+ u + 'deg) ';
            child[i].style.width=helpSquare +'px';        //раскладываем картинку
            child[i].style.height=helpSquare +'px';
            child[i].style.opacity=0.9;
            child[0].style.opacity=1;
            child[i].style.transitionDuration=3+'s';
            var audio3 = new Audio('Sound/Help.mp3');
            audio3.play(); 
        
        }                       
        setTimeout(complete, 7000);
        function complete(){
            for (var i=0; i<child.length; i++){
            var x=0;
            var y=0;
            var ex=example[choice];
            var u=ex[i*2+1];
            child[i].style.transform='translateZ(0)translateX('+x+'px)translateY('+y+'px)rotate('+ u + 'deg) ';
            child[i].style.width=square +'px';        //складываем картинку
            child[i].style.height=square +'px';
            child[i].style.opacity=1;
            child[i].style.transitionDuration=3+'s';
        }           
        }
    }
    function showRezult(){
        console.log(rezult);
        if (rezult==true){
           confe();
           winner();
        }
        else loser();
    }
    function confe(){
        var count = 200;
        var defaults = {
        origin: { y: 0.7 }
        };

    function fire(particleRatio, opts) {
    confetti(Object.assign({}, defaults, opts, {
    particleCount: Math.floor(count * particleRatio)
    }));
    }

    fire(0.25, {
    spread: 26,
    startVelocity: 55,
    });
    fire(0.2, {
    spread: 60,
    });
    fire(0.35, {
    spread: 100,
    decay: 0.91,
    scalar: 0.8
    });
    fire(0.1, {
    spread: 120,
    startVelocity: 25,
    decay: 0.92,
    scalar: 1.2
    });
    fire(0.1, {
    spread: 120,
    startVelocity: 45,
    });
    };
    function winner(){
        var scrn=document.getElementById('scr');
        var win=document.createElement('div');
        
        win.style.position='absolute';
        win.style.width=500 +'px';
        win.style.height=80 +'px';
        win.style.zIndex=1000;
        win.style.borderColor='red';
        win.style.borderWidth=2+'px';
        win.style.borderRadius=10+'%';
        win.style.borderStyle='solid';
        win.style.backgroundColor='yellow';
        win.style.opacity=0.8;
        win.style.display='inline-block';
        win.style.left=document.body.offsetWidth/2-250+'px';
        win.style.top=document.body.offsetHeight/2-40+'px';
        win.innerHTML='ПРАВИЛЬНО';
        win.style.fontSize=2.5+'em';
        win.style.color='blue';
        win.style.textAlign='center';
        win.style.paddingTop=1+'em';
        console.log(win, scrn);
        scrn.appendChild(win); 
        var audio4 = new Audio('Sound/tada.mp3');
            audio4.play(); 
        setTimeout(clearW, 4000);
        function clearW(){
            scrn.removeChild(win); 
        }  
    }
    function loser(){
        var scrn=document.getElementById('scr');
        var los=document.createElement('div');        
        los.style.position='absolute';
        los.style.width=500 +'px';
        los.style.height=100 +'px';
        los.style.zIndex=1000;
        los.style.borderColor='#0ad4f8';
        los.style.borderWidth=2+'px';
        los.style.borderRadius=10+'%';
        los.style.borderStyle='solid';
        los.style.opacity=0.8;
        los.style.backgroundColor='#16395a';
        los.style.display='inline-block';
        los.style.left=document.body.offsetWidth/2-250+'px';
        los.style.top=document.body.offsetHeight/2-50+'px';
        los.innerHTML='ПОПРОБУЙ ЕЩЕ РАЗ';
        los.style.fontSize=2+'em';
        los.style.color='red';
        los.style.textAlign='center';
        los.style.paddingTop=1.5+'em';
        scrn.appendChild(los);
        var audio5 = new Audio('Sound/Lose.mp3');
            audio5.play();   

        setTimeout(clearL, 4000);
        function clearL(){
            scrn.removeChild(los); 
        }        
    }   

    
    var mn=document.getElementById('mainPa');

    function imgCatalog(){                                           //функция вызывает каталог заданий
        var catalog=document.createElement('div');
        catalog.id='catalog';
        myPage=document.getElementById('myPage');
        
        myPage.innerHTML='';

        myPage.appendChild(catalog);
        var catName=document.createElement('h1');                    //создаем заголовок
        catName.innerText='КАТАЛОГ ЗАДАНИЙ';
        catName.style.textAlign='center';
        catalog.appendChild(catName);
        for(var p=0; p<example.length; p++){                       //  циклом создаем контейнеры для образцов
            var pattern=document.createElement('div');
            pattern.style.display='inline-block';
            pattern.style.width=square/2 +'px';
            pattern.style.height=square/2 +'px';
            pattern.style.margin=20+'px';
            pattern.className=p;
            pattern.onclick=patChoice;
                        
            var pat=example[p];                   //Находим нужный образец по индексу в массиве Example
        
                for (var i=0; i<pat.length; i+=2 ){               //циклом заполняем образцы
                var pn=document.createElement('img');
                pn.src=(pat[i].src);
                pn.style.position='absolute';
                pn.style.width=square/2 +'px';
                pn.style.height=square/2 +'px';
                pn.className=p;
                pn.style.zIndex=i;
                pn.style.borderColor='#d8bfd8';
                pn.style.borderWidth=2+'px';
                pn.style.borderRadius=5+'px';
                pn.style.borderStyle='solid';
                
                var u=pat[i+1];
                pn.style.transform='rotate('+ u + 'deg)';
                pattern.appendChild(pn);
            }
            catalog.appendChild(pattern);       //подвешиваем к дереву DOM
        }
        switchToState( { pagename:'Catalog' } );
    };
    function patChoice(EO) {          //Переходим на страницу Game с выбранным образцом
        EO = EO || window.event;
        var yourImg = EO.target;
        choice=parseInt(yourImg.className); 
        console.log(choice);
        runGame(choice);
    }    

    function runGame(){       //Запускает страницу Game
        console.log(choice);
        myPage.innerHTML='';
        myPage.appendChild(scrn); 
        switchToState( { pagename:'Game', numberChoice:choice } );
        exampleChoice(choice);
        
        var c=0;
        if (record.length>0){
        for (c=record.length; c>=0;  c=c-2){
            imgDelete();                   
        }  
        }  
            
    }
    

    function switchToStateFromURLHash() {
        var URLHash=window.location.hash;    

        var stateJSON=decodeURIComponent(URLHash.substr(1));     // убираем из закладки УРЛа решётку  и декодируем из формата УРЛ
        console.log(stateJSON);
        if ( stateJSON!="" )
            SPAState=JSON.parse(stateJSON);     // если JSON непустой, читаем из него состояние и отображаем
        else
            SPAState={pagename:'Main'};         // иначе показываем главную страницу
            
        switch ( SPAState.pagename) {      // обновляем вариабельную часть страницы под текущее состояние (цепляем к DOM нужную ветку)
            case 'Main':
                mainPage();  
                
            break;
            case 'Game':
                console.log(SPAState.numberChoice);
                if(!SPAState.numberChoice){
                    choice=choice;
                    
                }
                else {choice=SPAState.numberChoice};
                runGame(choice);
                
            break;
            case 'Catalog':
                imgCatalog();
                
            break;
        }
    }

    function switchToState(newState) {          // устанавливает в закладке УРЛа новое состояние приложения  и затем устанавливает+отображает это состояние
                                                // устанавливаем закладку УРЛа (кодируя как положено любые компоненты УРЛ)
        location.hash=encodeURIComponent(JSON.stringify(newState));
        //console.log(location.hash,newState)
    }                                                               // АВТОМАТИЧЕСКИ вызовется switchToStateFromURLHash()
                                            // т.к. закладка УРЛа изменилась (ЕСЛИ она действительно изменилась)

    switchToStateFromURLHash();   // переключаемся в состояние, которое сейчас прописано в закладке УРЛ

    

    
    
    </script>
       
    </body>
    
</html>